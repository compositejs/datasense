// DataSense
var DataSense,__assign=this&&this.__assign||function(){return __assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||(ar||(ar=Array.prototype.slice.call(from,0,i)),ar[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))},__extends=this&&this.__extends||function(){var extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])},extendStatics(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(DataSense){!function(Access){function convertToDetails(key,prop){return{hasValue:prop.hasOwnProperty("value"),key:key,value:prop.value,store:__assign({},prop.store),cacheOptions:prop.caching,updateTime:prop.updated,requestHandlerTypes:Object.keys(prop.factory),flowCount:prop.flows.length}}Access.setPromise=function(setter,value,compatible,message){return void 0===value?Promise.reject("value is undefined"):"function"!=typeof value.then?compatible?(setter(value),Promise.resolve(value)):Promise.reject("value is not a Promise object"):value.then(function(r){return setter(r,message),r})},Access.setSubscribe=function(setter,value,message,callbackfn,thisArg){var needCallback="function"==typeof callbackfn;return value.subscribe(function(newValue){var result=setter(newValue,message);if(needCallback){var fireObj="string"==typeof message?{message:message}:message||{};callbackfn.call(thisArg,result,fireObj)}})},Access.propsAccessor=function(){var formatter,validator,store={},eventManager=new DataSense.EventController,hasProp=function(key){return store.hasOwnProperty(key)&&store[key].hasOwnProperty("value")},getProp=function(key,ensure,ignoreExpiration){if(key&&"string"==typeof key){var obj=store[key];if(obj){if(!ignoreExpiration){var cacheOptions=obj.caching;if(cacheOptions)if(function(cacheOptions,updateTime){if(!cacheOptions||!cacheOptions.expiresIn)return!1;var now=new Date;return cacheOptions.expiresIn instanceof Date?now>cacheOptions.expiresIn:!updateTime||now.getTime()>updateTime.getTime()+cacheOptions.expiresIn}(cacheOptions,obj.updated))delete obj.value;else if("function"==typeof cacheOptions.handler){var expiration=void 0;expiration=cacheOptions.expiresIn instanceof Date?cacheOptions.expiresIn:"number"==typeof cacheOptions.expiresIn?new Date((new Date).getTime()+cacheOptions.expiresIn):void 0,cacheOptions.handler({value:obj.value,formatRev:cacheOptions.formatRev,tag:cacheOptions.tag,expiration:expiration,updated:obj.updated})&&delete obj.value}}}else obj={handlers:[],store:{},flows:[],factory:{}},ensure&&(store[key]=obj);return obj}},actionRequests={},undefinedProps=[],notifyUndefinedProp=function(prop,key){prop.hasOwnProperty("value")||undefinedProps.indexOf(key)>=0||(undefinedProps.push(key),undefinedProps.length>50&&(undefinedProps=undefinedProps.slice(1)),eventManager.fire("prop-empty",{key:key}))},setProp=function(key,value,message,init,getResp){var prop=getProp(key,!0);if(!prop)return getResp?new DataSense.ChangedInfo(null,"invalid",!1,void 0,void 0,value,"key is not valid"):void 0;if(init&&prop.hasOwnProperty("value"))return getResp?DataSense.ChangedInfo.fail(key,prop.value,value,"ignore"):void 0;if(prop.updating){if(!prop.updating.custom&&prop.updating.value===value)return getResp?DataSense.ChangedInfo.fail(key,prop.value,value,"duplicated"):void 0;prop.updating.cancel("duplicated")}var onceC=new DataSense.OnceController,setToken=prop.updating={value:value,cancel:function(err){onceC.reject(err)}},propExist=hasProp(key),oldValue=prop.value;eventManager.fire("ing-"+key,new DataSense.ChangingInfo(key,oldValue,value,onceC.createObservable()),message),eventManager.fire("prop-changing",new DataSense.ChangingInfo(key,oldValue,value,onceC.createObservable()),message);var flowTokens=prop.flows.map(function(item){if("function"==typeof item)return item(value,message)}),valueRequested=value;if("function"==typeof formatter&&(value=formatter(key,value)),"function"==typeof validator&&!validator(key,value)){if(setToken!==prop.updating)return onceC.reject("expired"),getResp?DataSense.ChangedInfo.fail(key,prop.value,value,"expired"):void 0;var errorInfo=DataSense.ChangedInfo.fail(key,oldValue,value,"invalid");return onceC.reject("invalid"),eventManager.fire("err-"+key,errorInfo,message),eventManager.fire("prop-failed",errorInfo,message),flowTokens.forEach(function(item){item&&"function"==typeof item.reject&&item.reject("invalid")}),errorInfo}if(setToken!==prop.updating)return onceC.reject("expired"),getResp?DataSense.ChangedInfo.fail(key,prop.value,value,"expired"):void 0;if(prop.updating=null,prop.updated=new Date,message&&"string"!=typeof message&&("boolean"!=typeof message.cacheOptions&&null!==message.cacheOptions||message.cacheOptions||(prop.caching=null),"number"!=typeof message.cacheOptions&&"string"!=typeof message.cacheOptions&&(prop.caching=message.cacheOptions)),prop.value=value,onceC.resolve(value),oldValue===value)return DataSense.ChangedInfo.success(key,value,oldValue,propExist?null:"add",valueRequested);var info=DataSense.ChangedInfo.success(key,value,oldValue,propExist?null:"add",valueRequested);return eventManager.fire("ed-"+key,info,message),eventManager.fire("prop-changed",info,message),flowTokens.forEach(function(item){item&&"function"==typeof item.resolve&&item.resolve(value)}),info},removeProp=function(keys,message){if(!keys)return[];if("string"==typeof keys&&(keys=[keys]),!(keys instanceof Array))return[];var result=[];return keys.forEach(function(key){var prop=getProp(key,!1);if(prop&&hasProp(key)){var oldValue=prop.value,onceC=new DataSense.OnceController,setToken=prop.updating={value:void 0,cancel:function(err){onceC.reject(err)}};eventManager.fire("ing-"+key,new DataSense.ChangingInfo(key,oldValue,void 0,onceC.createObservable()),message),eventManager.fire("prop-changing",new DataSense.ChangingInfo(key,oldValue,void 0,onceC.createObservable()),message);var flowTokens=prop.flows.map(function(item){if("function"==typeof item)return item(void 0,message)});if(setToken!==prop.updating)return onceC.reject("expired"),DataSense.ChangedInfo.fail(key,prop.value,void 0,"expired");prop.updating=null,prop.updated=new Date,delete prop.caching,delete prop.value;var info=DataSense.ChangedInfo.success(key,void 0,oldValue);result.push(info),onceC.resolve(void 0),void 0!==oldValue&&(eventManager.fire("ed-"+key,info,message),eventManager.fire("prop-changed",info,message),flowTokens.forEach(function(item){item&&"function"==typeof item.resolve&&("function"==typeof item.remove?item.remove():item.resolve(void 0))}))}}),result},changerClient={hasProp:function(key){return hasProp(key)},getProp:function(key,options){var prop=getProp(key,!1,null==options?void 0:options.ignoreExpires);if(notifyUndefinedProp(prop,key),options&&"function"==typeof options.callback&&options.callback(convertToDetails(key,prop)),options&&prop.caching){var rev=prop.caching.formatRev;if("number"==typeof rev){if("number"==typeof options.minFormatRev&&rev<options.minFormatRev)return;if("number"==typeof options.maxFormatRev&&rev>options.maxFormatRev)return}if(prop.updated&&options.earliest instanceof Date&&options.earliest>prop.updated)return}return prop?prop.value:void 0},getPropDetails:function(key){var prop=getProp(key,!1);return notifyUndefinedProp(prop,key),convertToDetails(key,prop)},setProp:function(key,value,message){var info=setProp(key,value,message,!1,!0);return info&&eventManager.fire("batch-changed",{changed:info},message),info},customizedSetProp:function(key,valueRequested,message){var flowTokens,prop=getProp(key,!0);if(!prop)return{isAborted:!0,resolve:function(finalValue){},reject:function(err){}};if(prop.updating){if(prop.updating.value===valueRequested)return{isAborted:!0,resolve:function(finalValue){},reject:function(err){}};prop.updating.cancel("expired")}var obj,propExist=hasProp(key),oldValue=prop.value,onceC=new DataSense.OnceController,setToken=prop.updating={value:valueRequested,custom:!0,cancel:function(err){obj.isAborted=!0,onceC.reject(err)}};return eventManager.fire("ing-"+key,new DataSense.ChangingInfo(key,oldValue,valueRequested,onceC.createObservable()),message),eventManager.fire("prop-changing",new DataSense.ChangingInfo(key,oldValue,valueRequested,onceC.createObservable()),message),flowTokens=prop.flows.map(function(item){if("function"==typeof item)return item(valueRequested,message)}),obj={resolve:function(finalValue){if(setToken===prop.updating){if(0===arguments.length&&(finalValue=valueRequested),prop.updating=null,onceC.resolve(finalValue),oldValue===finalValue)return DataSense.ChangedInfo.success(key,finalValue,oldValue,propExist?null:"add",valueRequested);prop.updated=new Date,delete prop.caching,message&&"string"!=typeof message&&message.cacheOptions&&(prop.caching=message.cacheOptions),prop.value=finalValue;var info=DataSense.ChangedInfo.success(key,finalValue,oldValue,propExist?null:"add",valueRequested);return eventManager.fire("ed-"+key,info,message),eventManager.fire("prop-changed",info,message),flowTokens.forEach(function(item){item&&"function"==typeof item.resolve&&item.resolve(finalValue)}),info}},reject:function(err){if(setToken===prop.updating){prop.updating=null,obj.isAborted=!0;var errorInfo=DataSense.ChangedInfo.fail(key,oldValue,valueRequested,"invalid");onceC.reject("invalid"),eventManager.fire("err-"+key,errorInfo,message),eventManager.fire("prop-failed",errorInfo,message),flowTokens.forEach(function(item){item&&"function"==typeof item.reject&&item.reject("invalid")})}},remove:function(){if(setToken===prop.updating&&(prop.updating=null,propExist)){if(onceC.resolve(void 0),void 0===oldValue)return DataSense.ChangedInfo.success(key,void 0,oldValue,"remove",valueRequested);prop.updated=new Date,delete prop.caching,delete prop.value;var info=DataSense.ChangedInfo.success(key,void 0,oldValue,"remove",valueRequested);return eventManager.fire("ed-"+key,info,message),eventManager.fire("prop-changed",info,message),flowTokens.forEach(function(item){item&&"function"==typeof item.resolve&&item.resolve(void 0)}),info}}},obj},removeProp:function(keys,message){var changed=removeProp(keys,message);return changed.length&&eventManager.fire("batch-changed",{changed:changed}),changed.length},batchProp:function(changeSet,message){if(changeSet){var changed=[],pushChanged=function(){for(var actionResult=[],_i=0;_i<arguments.length;_i++)actionResult[_i]=arguments[_i];DataSense.ChangedInfo.push.apply(DataSense.ChangedInfo,__spreadArray([changed],actionResult,!1))},batchPropChanged=function(changeSet){if(changeSet)for(var key in changeSet)if(key&&"string"==typeof key&&changeSet.hasOwnProperty(key)){var actionResult=setProp(key,changeSet[key],message);pushChanged(actionResult)}};changeSet instanceof Array?(changeSet.forEach(function(action){if(action&&action.action)switch(action.action){case"delete":pushChanged.apply(void 0,removeProp(action.key,message));break;case"batch":batchPropChanged(action.value);break;case"set":pushChanged(setProp(action.key,action.value,message));break;case"init":pushChanged(setProp(action.key,action.value,message,!0))}}),changed.length&&eventManager.fire("batch-changed",{changed:changed})):batchPropChanged(changeSet)}},forceUpdateProp:function(key,message){var propInfo=getProp(key,!1);if(propInfo){var onceC=new DataSense.OnceController;eventManager.fire("ing-"+key,new DataSense.ChangingInfo(key,propInfo.value,propInfo.value,onceC.createObservable()),message),eventManager.fire("prop-changing",new DataSense.ChangingInfo(key,propInfo.value,propInfo.value,onceC.createObservable()),message),onceC.resolve(propInfo.value);var info=DataSense.ChangedInfo.success(key,propInfo.value,propInfo.value);eventManager.fire("ed-"+key,info,message),eventManager.fire("prop-changed",info,message)}},getPropKeys:function(){return Object.keys(store).filter(function(key){return!!store[key]&&store[key].hasOwnProperty("value")})},getFormatter:function(){return formatter},setFormatter:function(h){formatter=h},getValidator:function(){return validator},setValidator:function(h){validator=h},getPropStore:function(key,storePropKey){return getProp(key,!0).store[storePropKey]},setPropStore:function(key,storePropKey,value){getProp(key,!0).store[storePropKey]=value},removePropStore:function(key){for(var storePropKey=[],_i=1;_i<arguments.length;_i++)storePropKey[_i-1]=arguments[_i];var propInfo=getProp(key,!1);if(propInfo){var prop=propInfo.store;storePropKey.forEach(function(storePropKey){delete prop.store[storePropKey]})}},getPropUpdateTime:function(key){var propInfo=getProp(key,!1);return propInfo?propInfo.updated:void 0},sendPropNotify:function(key,data,message){key&&"string"==typeof key&&eventManager.fire("ntf-"+key,data,message)},sendNotify:function(data,message){eventManager.fire("notify",data,message)},registerPropRequestHandler:function(key,type,h){var prop=getProp(key,!0).factory;if(h){if("function"!=typeof h)return!1;prop[type]=h}else delete prop[type];return!0},registerRequestHandler:function(type,h){if(h){if("function"!=typeof h)return!1;actionRequests[type]=h}else delete actionRequests[type];return!0}};return{accessor:changerClient,pushFlows:function(key){for(var flows=[],_i=1;_i<arguments.length;_i++)flows[_i-1]=arguments[_i];var now=new Date;flows=flows.filter(function(item){return"function"==typeof item});var flowArr=getProp(key,!0).flows,count=flowArr.push.apply(flowArr,flows);return{get registeredDate(){return now},get count(){return count},sync:function(message){flows.forEach(function(item){var currentValue=changerClient.getProp(key),token=item(currentValue,message);token&&"function"==typeof token.resolve&&token.resolve(currentValue)})},dispose:function(){flows.forEach(function(item){DataSense.Collection.remove(flowArr,item)})}}},clearFlows:function(key){var prop=getProp(key,!1),count=prop.flows.length;return prop.flows=[],count},sendPropRequest:function(key,type,value,owner){var requestH=getProp(key,!1).factory[type];"function"==typeof requestH&&requestH(owner,value)},sendRequest:function(type,value,owner){var requestH=actionRequests[type];"function"==typeof requestH&&requestH(owner,value)},sendPropBroadcast:function(key,data,message){key&&"string"==typeof key&&eventManager.fire("cst-"+key,data,message)},sendBroadcast:function(data,message){eventManager.fire("broadcast",data,message)},propChanging:eventManager.createMappedObservable("ing-{0}"),propChanged:eventManager.createMappedObservable("ed-{0}"),propChangeFailed:eventManager.createMappedObservable("err-{0}"),propNotifyReceived:eventManager.createMappedObservable("ntf-{0}"),propBroadcastReceived:eventManager.createMappedObservable("cst-{0}"),notifyReceived:eventManager.createSingleObservable("notify"),broadcastReceived:eventManager.createSingleObservable("broadcast"),anyPropChanging:eventManager.createSingleObservable("prop-changing"),anyPropChanged:eventManager.createSingleObservable("prop-changed"),anyPropChangeFailed:eventManager.createSingleObservable("prop-failed"),emptyPropRequested:eventManager.createSingleObservable("prop-empty"),propsChanged:eventManager.createSingleObservable("batch-changed")}}}(DataSense.Access||(DataSense.Access={}))}(DataSense||(DataSense={})),function(DataSense){!function(Collection){function findIndex(list,item,compare){if(!list||null==item)return-1;var findIndex=function(predicate){var resultIndex=-1;return list.some(function(ele,eleIndex,eleArr){return!!predicate(ele,eleIndex,eleArr)&&(resultIndex=eleIndex,!0)}),resultIndex};if(!compare)return findIndex(function(ele){return ele===item});switch(typeof compare){case"string":case"number":return findIndex(function(ele){return ele[compare]===item});case"function":return findIndex(function(ele){return compare(ele,item)});default:return-1}}Collection.findIndex=findIndex,Collection.remove=function(list,item,compare){for(var count=0;;){var index=findIndex(list,item,compare);if(index<0)break;list.splice(index,1),count++}return count}}(DataSense.Collection||(DataSense.Collection={}))}(DataSense||(DataSense={})),function(DataSense){var DisposableArray=function(){function DisposableArray(){this._list=[]}return DisposableArray.prototype.push=function(){for(var _this=this,items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];var count=0;return items.forEach(function(item){!item||_this._list.indexOf(item)>=0||(_this._list.push(item),"function"==typeof item.pushDisposable&&item.pushDisposable({dispose:function(){DataSense.Collection.remove(this._list,item)}}),count++)}),count},DisposableArray.prototype.pushDisposable=function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return this.push.apply(this,items)},DisposableArray.prototype.remove=function(){for(var _this=this,items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];var count=0;return items.forEach(function(item){item&&DataSense.Collection.remove(_this._list,item)<1||count++}),count},DisposableArray.prototype.removeDisposable=function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return this.remove.apply(this,items)},DisposableArray.prototype.dispose=function(){var list=this._list;this._list=[],DisposableArray.dispose(list)},DisposableArray.dispose=function(disposable){if(disposable){disposable instanceof Array||(disposable=[disposable]);var listFailed=[];disposable.forEach(function(item){if(item&&"function"==typeof item.dispose)try{item.dispose()}catch(ex){listFailed.push(item)}}),listFailed.forEach(function(item){item&&"function"==typeof item.dispose&&item.dispose()})}},DisposableArray}();DataSense.DisposableArray=DisposableArray}(DataSense||(DataSense={})),function(DataSense){var EventObservable=function(){function EventObservable(firer,mapKey){var disposable=new DataSense.DisposableArray,getKey=function(key){return mapKey&&key&&"string"==typeof key?"function"==typeof mapKey?mapKey(key):"string"==typeof mapKey?mapKey.replace("{0}",key).replace("{0}",key).replace("{0}",key):key:key};if(firer instanceof EventObservable&&firer._instance)return this.hasKeyMap=!!mapKey||firer.hasKeyMap,this._instance={push:function(key,obj){var keyMapped=getKey(key);return keyMapped&&keyMapped!==key&&(obj?obj.key=key:obj={key:key}),"function"==typeof firer._instance.push?firer._instance.push(keyMapped,obj):0},remove:function(key,obj){return"function"==typeof firer._instance.remove?firer._instance.remove(getKey(key),obj):0},fire:function(key,ev,message,obj){"function"==typeof firer._instance.fire&&firer._instance.fire(getKey(key),ev,message,obj)},pushDisposable:function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return disposable.pushDisposable.apply(disposable,items)},removeDisposable:function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return disposable.removeDisposable.apply(disposable,items)},dispose:function(){disposable.dispose()}},void firer.pushDisposable(this);this.hasKeyMap=!!mapKey;var store={},furtherHandlers=[],remove=function(key,obj){if(null===key){if(obj)return DataSense.Collection.remove(furtherHandlers,obj);var count2=furtherHandlers.length;return furtherHandlers=[],count2}if("string"!=typeof key||!key)return 0;if(obj)return DataSense.Collection.remove(store[key],obj);if(!store[key])return 0;var count=store[key].length;return store[key]=[],count},process=function(key,obj,ev,message,removing,further){if(!obj.isInvalid){var isInvalid=!1;if(obj.invalid&&(!0===obj.invalid?isInvalid=!0:"number"==typeof obj.invalid?obj.invalid<=obj.count&&(isInvalid=!0):"function"==typeof obj.invalid&&(isInvalid=obj.invalid(ev))),!isInvalid||(obj.isInvalid=!0,removing.push({key:further?null:key,value:obj}),obj.invalidForNextTime)){var latestFireDate=obj.latestFireDate,currentFireDate=obj.latestFireDate=new Date;obj.count<Number.MAX_SAFE_INTEGER&&obj.count++;var fireObj="string"==typeof message?{message:message}:message||{},working=!0;obj.task.process({ev:ev,c:{get key(){return obj.key||key},get originalKey(){return key},get count(){return obj.count},get fireDate(){return currentFireDate},get latestFireDate(){return latestFireDate},get lastFireDate(){return obj.latestFireDate},get registerDate(){return obj.time},get arg(){return obj.arg},get message(){return fireObj.message},get source(){return fireObj.source},get addition(){return fireObj.addition},hasStoreData:function(propKey){return obj.store.hasOwnProperty(propKey)},getStoreData:function(propKey){return obj.store[propKey]},setStoreData:function(propKey,propValue){obj.store[propKey]=propValue},removeStoreData:function(){for(var propKey=[],_i=0;_i<arguments.length;_i++)propKey[_i]=arguments[_i];var deltaCount=0;return propKey.forEach(function(propKeyItem){propKeyItem&&"string"==typeof propKeyItem&&(deltaCount++,delete obj.store[propKeyItem])}),deltaCount},dispose:function(){working?removing.push({key:further?null:key,value:obj}):remove(key,obj)}}}),working=!1}}};if(this._instance={push:function(key,obj){return obj?null===key?furtherHandlers.push(obj):"string"==typeof key&&key?(store[key]||(store[key]=[]),store[key].push(obj)):0:0},remove:function(key,obj){return remove(key,obj)},fire:function(key,ev,message,obj){if("string"==typeof key&&key&&store[key]){var removing=[],removingToken=setTimeout(function(){removing.forEach(function(removingItem){remove(removingItem.key,removingItem.value)})},0),removingH=function(){clearTimeout(removingToken),removing.forEach(function(removingItem){remove(removingItem.key,removingItem.value)})};if(obj){if(store[key].indexOf(obj)<0)return furtherHandlers.indexOf(obj)<0?void clearTimeout(removingToken):(process(key,obj,ev,message,removing,!0),void removingH());process(key,obj,ev,message,removing,!1)}else store[key].forEach(function(item){process(key,item,ev,message,removing,!1)}),furtherHandlers.forEach(function(item){process(key,item,ev,message,removing,!0)});removingH()}},pushDisposable:function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return disposable.pushDisposable.apply(disposable,items)},removeDisposable:function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return disposable.removeDisposable.apply(disposable,items)},dispose:function(){store={},disposable.dispose()}},"function"==typeof firer){var implInstance=this._instance;firer(function(key,ev,message){implInstance.fire(key,ev,message)},function(h,thisArg,options){h||(h=[]),h instanceof Array||(h=[h]),options||(options={});var task=new DataSense.HitTask;task.setOptions({delay:options.delay,mergeMode:options.mergeMode,span:options.span,minCount:options.minCount,maxCount:options.maxCount}),task.pushHandler(function(ev){h.forEach(function(handler){"function"==typeof handler&&handler(ev.ev,ev.c)})});var obj={task:task,arg:options.arg,thisArg:thisArg,invalid:options.invalid,invalidForNextTime:options.invalidForNextTime,time:new Date,store:{},count:0};implInstance.push(null,obj);var disposableResult={},result={get count(){return obj.count},get registerDate(){return obj.time},fire:function(key,ev,message){implInstance.fire(key,ev,message)},dispose:function(){implInstance.remove(null,obj),implInstance.removeDisposable(disposableResult),disposableResult.dispose=function(){},disposableResult.isDisposed=!0}};return disposableResult.dispose=function(){result.dispose()},implInstance.pushDisposable(disposableResult),result})}}return EventObservable.prototype.pushDisposable=function(){for(var _a,items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return(_a=this._instance).pushDisposable.apply(_a,items)},EventObservable.prototype.removeDisposable=function(){for(var _a,items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return(_a=this._instance).removeDisposable.apply(_a,items)},EventObservable.prototype.on=function(key,h,thisArg,options,disposableArray){h||(h=[]),h instanceof Array||(h=[h]);var disposableList=new DataSense.DisposableArray;if(!key||"string"!=typeof key||!h||!h.length){var now_1=new Date;return{get key(){return key},get count(){return 0},get registerDate(){return now_1},get state(){return"failure"},fire:function(ev,message){},pushDisposable:function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return disposableList.push.apply(disposableList,items)},removeDisposable:function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return disposableList.remove.apply(disposableList,items)},dispose:function(){disposableList.dispose()}}}options||(options={});var task=new DataSense.HitTask;task.setOptions({delay:options.delay,mergeMode:options.mergeMode,span:options.span,minCount:options.minCount,maxCount:options.maxCount}),task.pushHandler(function(ev){h.forEach(function(handler){"function"==typeof handler&&handler(ev.ev,ev.c)})});var obj={task:task,arg:options.arg,thisArg:thisArg,invalid:options.invalid,invalidForNextTime:options.invalidForNextTime,time:new Date,store:{},count:0},implInstance=this._instance;implInstance.push(key,obj);var disposableResult={},state="success",result={get key(){return key},get count(){return obj.count},get registerDate(){return obj.time},get state(){return state},fire:function(ev,message){implInstance.fire(key,ev,message)},pushDisposable:function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return disposableList.push.apply(disposableList,items)},removeDisposable:function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return disposableList.remove.apply(disposableList,items)},dispose:function(){implInstance.remove(key,obj),implInstance.removeDisposable(disposableResult),disposableList.dispose(),state="disposed",disposableResult.dispose=function(){},disposableResult.isDisposed=!0,disposableArray&&disposableArray.removeDisposable(disposableResult)}};return disposableResult.dispose=function(){result.dispose()},implInstance.pushDisposable(disposableResult),disposableArray&&disposableArray.pushDisposable(disposableResult),result},EventObservable.prototype.once=function(key,h,thisArg){return this.on(key,h,thisArg,{invalid:1})},EventObservable.prototype.clearOn=function(key){this._instance.remove(key)},EventObservable.prototype.createSingleObservable=function(key){return new SingleEventObservable(this,key)},EventObservable.prototype.subscribeSingle=function(key,h,thisArg,convertor){var result;if("function"!=typeof h)return(result=function(){}).dispose=function(){},result;var dispose=this.on(key,function(ev){"function"==typeof convertor&&(ev=convertor(ev)),h.call(thisArg,ev)});return(result=function(){dispose.dispose()}).dispose=dispose.dispose,result},EventObservable.prototype.createObservable=function(){return new EventObservable(this)},EventObservable.prototype.createMappedObservable=function(mapKey){return new EventObservable(this,mapKey)},EventObservable.prototype.dispose=function(){this._instance.dispose()},EventObservable.createFailedOnResult=function(key){var disposableList=new DataSense.DisposableArray;return{get key(){return key},get count(){return 0},get registerDate(){},get state(){return"failure"},fire:function(ev,message){},pushDisposable:function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return disposableList.push.apply(disposableList,items)},removeDisposable:function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return disposableList.remove.apply(disposableList,items)},dispose:function(){disposableList.dispose()}}},EventObservable.createNothingSubscribe=function(){var result=function(){};return result.dispose=function(){},result},EventObservable.createForElement=function(dom,eventType){var event=new EventController,listener=function(ev){event.fire(eventType,ev)};dom.addEventListener(eventType,listener);var obs=event.createSingleObservable(eventType);return obs.pushDisposable({dispose:function(){dom.removeEventListener(eventType,listener)}}),obs},EventObservable}();DataSense.EventObservable=EventObservable;var SingleEventObservable=function(){function SingleEventObservable(eventObservable,key){this.key=key,this._disposable=new DataSense.DisposableArray,this._eventObservable=eventObservable&&eventObservable instanceof EventObservable?eventObservable:new EventObservable(null),eventObservable.pushDisposable(this)}return SingleEventObservable.prototype.pushDisposable=function(){for(var _a,items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return(_a=this._disposable).pushDisposable.apply(_a,items)},SingleEventObservable.prototype.removeDisposable=function(){for(var _a,items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return(_a=this._disposable).removeDisposable.apply(_a,items)},SingleEventObservable.prototype.on=function(h,thisArg,options,disposableArray){var result=this._eventObservable.on(this.key,h,thisArg,options,disposableArray);return this._disposable.push(result),result},SingleEventObservable.prototype.once=function(h,thisArg){var result=this._eventObservable.once(this.key,h,thisArg);return this._disposable.push(result),result},SingleEventObservable.prototype.subscribe=function(h,thisArg){var result=this._eventObservable.subscribeSingle(this.key,h,thisArg);return this._disposable.push(result),result},SingleEventObservable.prototype.subscribeWithConvertor=function(h,thisArg,convertor){var result=this._eventObservable.subscribeSingle(this.key,h,thisArg,convertor);return this._disposable.push(result),result},SingleEventObservable.prototype.createObservable=function(){return new SingleEventObservable(this._eventObservable,this.key)},SingleEventObservable.prototype.dispose=function(){this._disposable.dispose()},SingleEventObservable}();DataSense.SingleEventObservable=SingleEventObservable;var EventController=function(_super){function EventController(){var f,o,_this=_super.call(this,function(fire,onAny){f=fire,o=onAny})||this;return _this._fireHandler=f,_this._onAny=o,_this}return __extends(EventController,_super),EventController.prototype.fire=function(key,ev,message,delay){var _this=this;DataSense.delay(function(){_this._fireHandler(key,ev,message)},delay)},EventController.prototype.onAny=function(h,thisArg,options,disposableArray){var onResult=this._onAny(h,thisArg,options);return disposableArray&&"function"==typeof disposableArray.pushDisposable&&disposableArray.pushDisposable(onResult),onResult},EventController.prototype.subscribeAny=function(h,thisArg){var result;if("function"!=typeof h)return(result=function(){}).dispose=function(){},result;var dispose=this.onAny(function(ev){h.call(thisArg,ev)});return(result=function(){dispose.dispose()}).dispose=dispose.dispose,result},EventController}(EventObservable);DataSense.EventController=EventController;var OnceObservable=function(){function OnceObservable(executor){var _this=this;if(this._result={},executor instanceof OnceObservable)this._result=executor._result;else if("function"==typeof executor){var process=function(success,value){var list;void 0===_this._result.success&&(success?(_this._result.value=value,_this._result.success=!0,list=_this._result.resolved):(_this._result.value=value,_this._result.success=!1,list=_this._result.rejected),delete _this._result.resolved,delete _this._result.rejected,list&&list.forEach(function(item){DataSense.delay(function(){item.h.call(item.thisArg,value)},item.delay)}))};executor(function(value){process(!0,value)},function(err){process(!1,err)})}}return Object.defineProperty(OnceObservable.prototype,"isPending",{get:function(){return void 0===this._result.success},enumerable:!1,configurable:!0}),Object.defineProperty(OnceObservable.prototype,"isSuccessful",{get:function(){return!0===this._result.success},enumerable:!1,configurable:!0}),Object.defineProperty(OnceObservable.prototype,"isFailed",{get:function(){return!1===this._result.success},enumerable:!1,configurable:!0}),OnceObservable.prototype.onResolved=function(h,thisArg,delay){!0!==this._result.success?!1!==this._result.success&&(this._result.resolved||(this._result.resolved=[]),this._result.resolved.push({h:h,delay:delay,thisArg:thisArg})):h.call(thisArg,this._result.value)},OnceObservable.prototype.onResolvedLater=function(h,thisArg,delay){var _this=this;DataSense.delay(function(){_this.onResolved(h,thisArg,delay)},!0)},OnceObservable.prototype.onRejected=function(h,thisArg,delay){!1!==this._result.success?!0!==this._result.success&&(this._result.rejected||(this._result.rejected=[]),this._result.rejected.push({h:h,delay:delay,thisArg:thisArg})):h.call(thisArg,this._result.value)},OnceObservable.prototype.onRejectedLater=function(h,thisArg,delay){var _this=this;DataSense.delay(function(){_this.onRejected(h,thisArg,delay)},!0)},OnceObservable.prototype.promise=function(){var _this=this;return new Promise(function(resolve,reject){_this.onResolved(resolve),_this.onRejected(reject)})},OnceObservable.prototype.then=function(onfulfilled,onrejected){return this.promise().then(onfulfilled,onrejected)},OnceObservable.prototype.catch=function(onrejected){return this.promise().catch(onrejected)},OnceObservable.prototype.createObservable=function(){return new OnceObservable(this)},OnceObservable}();DataSense.OnceObservable=OnceObservable;var OnceController=function(_super){function OnceController(){var a,_this=_super.call(this,function(resolve,reject){a={resolve:resolve,reject:reject}})||this;return _this._instance=a,_this}return __extends(OnceController,_super),OnceController.prototype.resolve=function(value){this._instance.resolve(value)},OnceController.prototype.reject=function(err){this._instance.reject(err)},OnceController}(OnceObservable);DataSense.OnceController=OnceController;var ChangingInfo=function(){function ChangingInfo(key,currentValue,valueRequest,observable,action){this.key=key,this.currentValue=currentValue,this.valueRequest=valueRequest,this.observable=observable,this.action=action,action||(this.action="update")}return ChangingInfo.prototype.onResolved=function(h,thisArg,delay){this.observable&&this.observable.onResolved(h,thisArg,delay)},ChangingInfo.prototype.onRejected=function(h,thisArg,delay){this.observable&&this.observable.onRejected(h,thisArg,delay)},ChangingInfo}();DataSense.ChangingInfo=ChangingInfo;var ChangedInfo=function(){function ChangedInfo(key,action,success,value,oldValue,valueRequest,error){this.key=key,this.action=action,this.success=success,this.value=value,this.oldValue=oldValue,this.valueRequest=valueRequest,this.error=error}return Object.defineProperty(ChangedInfo.prototype,"hasChanged",{get:function(){return this.oldValue===this.value},enumerable:!1,configurable:!0}),ChangedInfo.success=function(key,value,oldValue,action,valueRequest,error){return action?!0===action&&(action=value===oldValue?"none":"update"):action=key?value===oldValue?"none":void 0===value?"add":void 0===oldValue?"remove":"update":value===oldValue?"none":"update",new ChangedInfo(key,action,!0,value,oldValue,arguments.length>4?valueRequest:value,error)},ChangedInfo.fail=function(key,value,valueRequest,error){return new ChangedInfo(key,"none",!1,value,value,valueRequest,error)},ChangedInfo.push=function(list){for(var items=[],_i=1;_i<arguments.length;_i++)items[_i-1]=arguments[_i];if(list){var index=-1;items.forEach(function(item){item&&item.key&&(list.some(function(test,i){return test.key===item.key&&(index=i,!0)}),index>=0?list[index]=item:list.push(item))})}},ChangedInfo}();DataSense.ChangedInfo=ChangedInfo,DataSense.createEvent=function(){return new EventController}}(DataSense||(DataSense={})),"function"==typeof define?(define.amd||"undefined"!=typeof __webpack_require__)&&define(["exports"],function(exports){return DataSense}):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module&&(module.exports=DataSense),function(DataSense){var PropsObservable=function(){function PropsObservable(changer){var disposable=new DataSense.DisposableArray;if(changer instanceof PropsObservable&&changer._instance)return this._instance=__assign(__assign({},changer._instance),{pushDisposable:function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return disposable.pushDisposable.apply(disposable,items)},removeDisposable:function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return disposable.removeDisposable.apply(disposable,items)},dispose:function(){disposable.dispose()}}),this.propChanging=changer.propChanging.createObservable(),this.propChanged=changer.propChanged.createObservable(),this.propChangeFailed=changer.propChangeFailed.createObservable(),this.propBroadcastReceived=changer.propBroadcastReceived.createObservable(),this.propNotifyReceived=changer.propNotifyReceived.createObservable(),this.anyPropChanging=changer.anyPropChanging.createObservable(),this.anyPropChanged=changer.anyPropChanged.createObservable(),this.anyPropChangeFailed=changer.anyPropChangeFailed.createObservable(),this.emptyPropRequested=changer.emptyPropRequested.createObservable(),this.propsChanged=changer.propsChanged.createObservable(),this.broadcastReceived=changer.broadcastReceived.createObservable(),this.notifyReceived=changer.notifyReceived.createObservable(),this.pushDisposable(this.propChanging,this.propChanged,this.propChangeFailed,this.propBroadcastReceived,this.propNotifyReceived,this.anyPropChanging,this.anyPropChanged,this.anyPropChangeFailed,this.emptyPropRequested,this.propsChanged,this.broadcastReceived,this.notifyReceived),void changer.pushDisposable(this);var obj=DataSense.Access.propsAccessor();this.propChanging=obj.propChanging,this.propChanged=obj.propChanged,this.propChangeFailed=obj.propChangeFailed,this.propBroadcastReceived=obj.propBroadcastReceived,this.propNotifyReceived=obj.propNotifyReceived,this.anyPropChanging=obj.anyPropChanging,this.anyPropChanged=obj.anyPropChanged,this.anyPropChangeFailed=obj.anyPropChangeFailed,this.emptyPropRequested=obj.emptyPropRequested,this.propsChanged=obj.propsChanged,this.broadcastReceived=obj.broadcastReceived,this.notifyReceived=obj.notifyReceived,disposable.pushDisposable(this.propChanging,this.propChanged,this.propChangeFailed,this.propBroadcastReceived,this.propNotifyReceived,this.anyPropChanging,this.anyPropChanged,this.anyPropChangeFailed,this.emptyPropRequested,this.propsChanged,this.broadcastReceived,this.notifyReceived);var simpleAccessor={hasProp:function(key){return obj.accessor.hasProp(key)},getProp:function(key,options){return obj.accessor.getProp(key,options)},getPropKeys:function(){return obj.accessor.getPropKeys()},setProp:function(key,value,message){return obj.accessor.setProp(key,value,message)},removeProp:function(keys,message){return obj.accessor.removeProp(keys,message)},batchProp:function(changeSet,message){return obj.accessor.batchProp(changeSet,message)},forceUpdateProp:function(key){obj.accessor.forceUpdateProp(key)}},sendPropRequestH=function(key,type,value){obj.sendPropRequest(key,type,value,function(key){return{get:function(options){return obj.accessor.getProp(key,options)},set:function(value,message){return obj.accessor.setProp(key,value,message)},forceUpdate:function(){obj.accessor.forceUpdateProp(key)}}}(key))},sendRequestH=function(type,value){obj.sendRequest(type,value,simpleAccessor)},sendPropBroadcastH=function(key,type,value){obj.sendPropBroadcast(key,type,value)},sendBroadcastH=function(type,value){obj.sendBroadcast(type,value)};if(this._instance={has:function(key){return obj.accessor.hasProp(key)},get:function(key,options){return obj.accessor.getProp(key,options)},getDetails:function(key){return obj.accessor.getPropDetails(key)},getUpdateTime:function(key){return obj.accessor.getPropUpdateTime(key)},keys:function(){return obj.accessor.getPropKeys()},pushFlows:function(key){for(var flows=[],_i=1;_i<arguments.length;_i++)flows[_i-1]=arguments[_i];return obj.pushFlows.apply(obj,__spreadArray([key],flows,!1))},clearFlows:function(key){return obj.clearFlows(key)},sendPropRequest:function(key,type,value){sendPropRequestH(key,type,value)},sendRequest:function(type,value){sendRequestH(type,value)},sendPropBroadcast:function(key,data,message){sendPropBroadcastH(key,data,message)},sendBroadcast:function(data,message){sendBroadcastH(data,message)},pushDisposable:function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return disposable.pushDisposable.apply(disposable,items)},removeDisposable:function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return disposable.removeDisposable.apply(disposable,items)},dispose:function(){disposable.dispose()}},"function"==typeof changer){var eventsMore=changer.additionalEvents;eventsMore&&(eventsMore.broadcastReceived instanceof DataSense.SingleEventObservable&&(this.broadcastReceived=eventsMore.broadcastReceived,this.pushDisposable(this.broadcastReceived)),eventsMore.propBroadcastReceived instanceof DataSense.EventObservable&&(this.propBroadcastReceived=eventsMore.propBroadcastReceived,this.pushDisposable(this.propBroadcastReceived)),eventsMore.notifyReceived instanceof DataSense.SingleEventObservable&&(this.notifyReceived=eventsMore.notifyReceived,this.pushDisposable(this.notifyReceived)),eventsMore.propNotifyReceived instanceof DataSense.EventObservable&&(this.propNotifyReceived=eventsMore.propNotifyReceived,this.pushDisposable(this.propNotifyReceived)),"function"==typeof eventsMore.sendRequest&&(sendRequestH=eventsMore.sendRequest),"function"==typeof eventsMore.sendPropRequest&&(sendPropRequestH=eventsMore.sendPropRequest),"function"==typeof eventsMore.sendBroadcast&&(sendBroadcastH=eventsMore.sendBroadcast),"function"==typeof eventsMore.sendPropBroadcast&&(sendPropBroadcastH=eventsMore.sendPropBroadcast)),changer(obj.accessor)}}return PropsObservable.prototype.pushDisposable=function(){for(var _a,items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return(_a=this._instance).pushDisposable.apply(_a,items)},PropsObservable.prototype.removeDisposable=function(){for(var _a,items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return(_a=this._instance).removeDisposable.apply(_a,items)},PropsObservable.prototype.getKeys=function(){return this._instance.keys()},PropsObservable.prototype.hasProp=function(key){return this._instance.has(key)},PropsObservable.prototype.getProp=function(key,options){return this._instance.get(key,options)},PropsObservable.prototype.getPropUpdateTime=function(key){return this._instance.getUpdateTime(key)},PropsObservable.prototype.getPropDetails=function(key){return this._instance.getDetails(key)},PropsObservable.prototype.getPropsArray=function(keys){var arr=[];for(var key in keys)arr.push(this._instance.get(key));return arr},PropsObservable.prototype.getPropsObject=function(keys){var obj={};for(var key in keys){var v=this._instance.get(key);void 0!==v&&(obj[key]=v)}return obj},PropsObservable.prototype.fillPropsObject=function(obj,keys,ignoreIfExists){if(void 0===ignoreIfExists&&(ignoreIfExists=!1),obj){var i=0;if(!ignoreIfExists){for(var key in keys){void 0!==(v=this._instance.get(key))&&(obj[key]=v,i++)}return i}var props=Object.getOwnPropertyNames(obj);for(var key in keys){var v;if(!(props.indexOf(key)>=0))void 0!==(v=this._instance.get(key))&&(obj[key]=v,i++)}return i}},PropsObservable.prototype.getPropsDetails=function(keys){var arr=[];for(var key in keys)arr.push(this._instance.getDetails(key));return arr},PropsObservable.prototype.registerChangeFlow=function(key){for(var _a,value=[],_i=1;_i<arguments.length;_i++)value[_i-1]=arguments[_i];return(_a=this._instance).pushFlows.apply(_a,__spreadArray([key],value,!1))},PropsObservable.prototype.clearChangeFlow=function(key){return this._instance.clearFlows(key)},PropsObservable.prototype.onPropChanging=function(key,h,thisArg,options,disposableArray){return this.propChanging.on(key,h,thisArg,options,disposableArray)},PropsObservable.prototype.onPropChanged=function(key,h,thisArg,options,disposableArray){return this.propChanged.on(key,h,thisArg,options,disposableArray)},PropsObservable.prototype.onPropChangeFailed=function(key,h,thisArg,options,disposableArray){return key&&"string"==typeof key?this.propChangeFailed.on(key,h,thisArg,options,disposableArray):DataSense.EventObservable.createFailedOnResult(null)},PropsObservable.prototype.onAnyPropChanging=function(h,thisArg,options,disposableArray){return this.anyPropChanging.on(h,thisArg,options,disposableArray)},PropsObservable.prototype.onAnyPropChanged=function(h,thisArg,options,disposableArray){return this.anyPropChanged.on(h,thisArg,options,disposableArray)},PropsObservable.prototype.onAnyPropChangeFailed=function(h,thisArg,options,disposableArray){return this.anyPropChangeFailed.on(h,thisArg,options,disposableArray)},PropsObservable.prototype.onPropsChanged=function(h,thisArg,options,disposableArray){return this.propsChanged.on(h,thisArg,options,disposableArray)},PropsObservable.prototype.onPropBroadcastReceived=function(key,h,thisArg,options,disposableArray){return this.propBroadcastReceived.on(key,h,thisArg,options,disposableArray)},PropsObservable.prototype.onBroadcastReceived=function(h,thisArg,options,disposableArray){return this.broadcastReceived.on(h,thisArg,options,disposableArray)},PropsObservable.prototype.onPropNotifyReceived=function(key,h,thisArg,options,disposableArray){return this.propNotifyReceived.on(key,h,thisArg,options,disposableArray)},PropsObservable.prototype.onNotifyReceived=function(h,thisArg,options,disposableArray){return this.notifyReceived.on(h,thisArg,options,disposableArray)},PropsObservable.prototype.subscribeProp=function(key,h,thisArg){return this.propChanged.subscribeSingle(key,h,thisArg,function(newValue){return newValue.value})},PropsObservable.prototype.subscribeProps=function(h,thisArg){return this.propsChanged.subscribeWithConvertor(h,thisArg,function(changeSet){return changeSet.changes})},PropsObservable.prototype.sendPropRequest=function(key,type,value){this._instance.sendPropRequest(key,type,value)},PropsObservable.prototype.sendRequest=function(type,value){this._instance.sendRequest(type,value)},PropsObservable.prototype.sendPropBroadcast=function(key,data,message){this._instance.sendPropBroadcast(key,data,message)},PropsObservable.prototype.sendBroadcast=function(data,message){this._instance.sendBroadcast(data,message)},PropsObservable.prototype.createPropObservable=function(key){var _this=this,obj={};this.propBroadcastReceived.createSingleObservable(key),this.propNotifyReceived.createSingleObservable(key);var result=new DataSense.ValueObservable(function(accessor){accessor.set(_this.getProp(key)),obj.accessor=accessor}),onToken=this.onPropChanging(key,function(ev,evController){var changeToken=obj.accessor.customizedSet(ev.currentValue,evController.message);ev.observable&&(ev.observable.onResolved(function(newValue){changeToken.resolve(newValue)}),ev.observable.onRejected(function(err){changeToken.reject(err)}))});return result.pushDisposable(onToken),result},PropsObservable.prototype.createObservable=function(){return new PropsObservable(this)},PropsObservable.prototype.copyModel=function(){var _this=this,obj={};return this.getKeys().forEach(function(key){obj[key]=_this.getProp(key)}),obj},PropsObservable.prototype.toJSON=function(){return this.copyModel()},PropsObservable.prototype.stringify=function(){var obj=this.copyModel();return JSON.stringify(obj)},PropsObservable.prototype.dispose=function(){this._instance.dispose()},PropsObservable}();DataSense.PropsObservable=PropsObservable;var PropsClient=function(_super){function PropsClient(defaultValue,modifier,propSetter,sendPropNotify,sendNotify,registerPropRequestHandler,registerRequestHandler,additionalEvents){var _this=this,h=function(acc){acc.batchProp(defaultValue),modifier(acc.customizedSetProp)};return additionalEvents&&(h.additionalEvents=additionalEvents),_this=_super.call(this,h)||this,"function"==typeof propSetter&&(_this._propSetter=propSetter),"function"==typeof sendPropNotify&&(_this._sendPropNotify=sendPropNotify),"function"==typeof sendNotify&&(_this._sendNotify=sendNotify),"function"==typeof registerPropRequestHandler&&(_this._registerPropRequestHandler=registerPropRequestHandler),"function"==typeof registerRequestHandler&&(_this._registerRequestHandler=registerRequestHandler),"undefined"==typeof Proxy||(_this.proxy=new Proxy({},{has:function(target,p){return!(!p||"string"!=typeof p)&&_this.hasProp(p)},get:function(target,p,receiver){if(p&&"string"==typeof p)return _this.getProp(p)},set:function(target,p,value,receiver){if(!p||"string"!=typeof p)throw new TypeError("the property key should be a string");return _this.setProp(p,value)},ownKeys:function(target){return _this.getKeys()}})),_this}return __extends(PropsClient,_super),PropsClient.prototype.setProp=function(key,value,message){if("function"!=typeof this._propSetter)return!1;var info=this._propSetter(key,value,message);return!!info&&info.success},PropsClient.prototype.setPropForDetails=function(key,value,message){return"function"!=typeof this._propSetter?DataSense.ChangedInfo.fail(null,void 0,value,"not implemented"):this._propSetter(key,value,message)},PropsClient.prototype.setPromiseProp=function(key,value,compatible,message){var _this=this;return DataSense.Access.setPromise(function(value,message){return _this.setPropForDetails(key,value,message)},value,compatible,message)},PropsClient.prototype.setSubscribeProp=function(key,value,message,callbackfn,thisArg){var _this=this;return DataSense.Access.setSubscribe(function(value,message){return _this.setPropForDetails(key,value,message)},value,message,callbackfn,thisArg)},PropsClient.prototype.sendPropNotify=function(key,data,message){"function"==typeof this._sendPropNotify&&this._sendPropNotify(key,data,message)},PropsClient.prototype.sendNotify=function(data,message){"function"==typeof this._sendNotify&&this._sendNotify(data,message)},PropsClient.prototype.registerPropRequestHandler=function(key,type,h){return"function"==typeof this._registerPropRequestHandler&&this._registerPropRequestHandler(key,type,h)},PropsClient.prototype.registerRequestHandler=function(type,h){return"function"==typeof this._registerRequestHandler&&this._registerRequestHandler(type,h)},PropsClient}(PropsObservable);DataSense.PropsClient=PropsClient;var PropsController=function(_super){function PropsController(){var a,_this=_super.call(this,function(acc){return a=acc})||this;return _this._accessor=a,"undefined"==typeof Proxy||(_this.proxy=new Proxy({},{has:function(target,p){return!(!p||"string"!=typeof p)&&_this.hasProp(p)},get:function(target,p,receiver){if(p&&"string"==typeof p)return _this.getProp(p)},set:function(target,p,value,receiver){if(!p||"string"!=typeof p)throw new TypeError("the property key should be a string");return _this.setProp(p,value)},ownKeys:function(target){return _this.getKeys()}})),_this}return __extends(PropsController,_super),Object.defineProperty(PropsController.prototype,"formatter",{get:function(){return this._accessor.getFormatter()},set:function(h){this._accessor.setFormatter(h)},enumerable:!1,configurable:!0}),Object.defineProperty(PropsController.prototype,"validator",{get:function(){return this._accessor.getValidator()},set:function(h){this._accessor.setValidator(h)},enumerable:!1,configurable:!0}),PropsController.prototype.getPropWithFallback=function(key,resolver,options){var _this=this,prop=this._accessor.getPropDetails(key);return options||(options={}),"function"==typeof options.callback&&options.callback(prop),prop.hasValue?Promise.resolve(prop.value):resolver(prop).then(function(value){return options.testBeforeSet&&(prop=_this._accessor.getPropDetails(key)).hasValue?prop.value:(_this._accessor.setProp(key,value),value)})},PropsController.prototype.forceUpdateProp=function(key,message){this._accessor.forceUpdateProp(key,message)},PropsController.prototype.setProp=function(key,value,message){var info=this._accessor.setProp(key,value,message);return!!info&&info.success},PropsController.prototype.setPropForDetails=function(key,value,message){return this._accessor.setProp(key,value,message)},PropsController.prototype.setPromiseProp=function(key,value,compatible,message){var _this=this;return DataSense.Access.setPromise(function(value,message){return _this.setPropForDetails(key,value,message)},value,compatible,message)},PropsController.prototype.setSubscribeProp=function(key,value,message,callbackfn,thisArg){var _this=this;return DataSense.Access.setSubscribe(function(value,message){return _this.setPropForDetails(key,value,message)},value,message,callbackfn,thisArg)},PropsController.prototype.removeProp=function(key,message){return this._accessor.removeProp(key,message)},PropsController.prototype.setProps=function(obj,message){return this._accessor.batchProp(obj,message)},PropsController.prototype.getPropStore=function(key,storePropKey){return this._accessor.getPropStore(key,storePropKey)},PropsController.prototype.setPropStore=function(key,storePropKey,value){this._accessor.setPropStore(key,storePropKey,value)},PropsController.prototype.removePropStore=function(key){for(var _a,storePropKeys=[],_i=1;_i<arguments.length;_i++)storePropKeys[_i-1]=arguments[_i];(_a=this._accessor).removePropStore.apply(_a,__spreadArray([key],storePropKeys,!1))},PropsController.prototype.sendPropNotify=function(key,data,message){this._accessor.sendPropNotify(key,data,message)},PropsController.prototype.sendNotify=function(data,message){this._accessor.sendNotify(data,message)},PropsController.prototype.registerPropRequestHandler=function(key,type,h){return this._accessor.registerPropRequestHandler(key,type,h)},PropsController.prototype.registerRequestHandler=function(type,h){return this._accessor.registerRequestHandler(type,h)},PropsController.prototype.createPropClient=function(key){var token,_this=this,client=new DataSense.ValueClient(this.getProp(key),function(modifier){token=_this.onPropChanging(key,function(ev,evController){var updateToken=modifier(ev.valueRequest,evController.message);ev.observable&&(ev.observable.onResolved(function(newValue){updateToken.resolve(newValue)}),ev.observable.onRejected(function(err){updateToken.reject(err)}))})},function(value,message){return _this.setPropForDetails(key,value,message)},function(data,message){_this._accessor.sendPropNotify(key,data,message)},function(type,h){return _this._accessor.registerPropRequestHandler(key,type,h)},{broadcastReceived:this.propBroadcastReceived.createSingleObservable(key),notifyReceived:this.propNotifyReceived.createSingleObservable(key),sendRequest:function(type,value){_this.sendPropRequest(key,type,value)},sendBroadcast:function(data,message){_this.sendPropBroadcast(key,data,message)}},function(message){_this.forceUpdateProp(key,message)});return client.pushDisposable(token),client},PropsController.prototype.createClient=function(){var token,_this=this,client=new PropsClient(this.copyModel(),function(modifier){token=_this.onAnyPropChanging(function(ev,evController){var updateToken=modifier(ev.key,ev.valueRequest,evController.message);ev.observable&&(ev.observable.onResolved(function(newValue){updateToken.resolve(newValue)}),ev.observable.onRejected(function(err){updateToken.reject(err)}))})},function(key,value,message){return _this.setPropForDetails(key,value,message)},this._accessor.sendPropNotify,this._accessor.sendNotify,this.registerPropRequestHandler,this.registerRequestHandler,{propBroadcastReceived:this.propBroadcastReceived.createObservable(),broadcastReceived:this.broadcastReceived.createObservable(),propNotifyReceived:this.propNotifyReceived.createObservable(),notifyReceived:this.notifyReceived.createObservable(),emptyPropRequested:this.emptyPropRequested.createObservable(),sendPropRequest:function(key,type,value){_this.sendPropRequest(key,type,value)},sendRequest:function(type,value){_this.sendRequest(type,value)},sendPropBroadcast:function(key,data,message){_this.sendPropBroadcast(key,data,message)},sendBroadcast:function(data,message){_this.sendBroadcast(data,message)}});return client.pushDisposable(token),this.pushDisposable(client),client.emptyPropRequested.on(function(ev){return _this.getProp(ev.key)}),client},PropsController}(PropsObservable);DataSense.PropsController=PropsController,DataSense.createProps=function(initObj){var p=new PropsController;return initObj&&p.setProps(initObj),p}}(DataSense||(DataSense={})),function(DataSense){var HitTask=function(){function HitTask(){var _this=this;this._options={},this._h=[];var procToken,latest,latest2,initDate=new Date,count=0,curCount=0,procH=function(arg){procToken=null;var latest3=latest;latest=new Date,count<Number.MAX_SAFE_INTEGER&&count++,_this._h.forEach(function(h){h(arg,{initDate:initDate,processDate:latest,latestProcessDate:latest3,count:count,hitCount:curCount})})};this._abort=function(){procToken&&clearTimeout(procToken),procToken=null},this._proc=function(arg){var now=new Date;curCount++;var options=_this._options;if((!options.span||!latest2||now.getTime()-latest2.getTime()>options.span)&&(curCount=1),latest2=new Date,!(null!=options.minCount&&curCount<options.minCount||null!=options.maxCount&&curCount>options.maxCount)){if(procToken)if("debounce"===options.mergeMode)clearTimeout(procToken);else if("mono"===options.mergeMode)return;null==options.delay||!1===options.delay?procH(arg):!0===options.delay?procToken=setTimeout(function(){procH(arg)},0):"number"==typeof options.delay&&(procToken=setTimeout(function(){procH(arg)},options.delay))}}}return HitTask.prototype.setOptions=function(value,merge){merge?value&&(this._options=__assign(__assign({},this._options),value)):this._options=value||{}},HitTask.prototype.pushHandler=function(){for(var _this=this,h=[],_i=0;_i<arguments.length;_i++)h[_i]=arguments[_i];var count=0;return h.forEach(function(handler){var _a;"function"==typeof handler?count+=_this._h.push(handler):handler instanceof Array&&(count+=(_a=_this._h).push.apply(_a,handler))}),count},HitTask.prototype.clearHandler=function(){this._h=[]},HitTask.prototype.process=function(arg){this._proc(arg)},HitTask.prototype.abort=function(){this._abort()},HitTask}();DataSense.HitTask=HitTask,DataSense.delay=function(h,span){var procToken;return null==span||!1===span?h():!0===span?procToken=setTimeout(function(){procToken=null,h()},0):"number"==typeof span&&(procToken=setTimeout(function(){procToken=null,h()},span)),{dispose:function(){procToken&&clearTimeout(procToken),procToken=null}}},DataSense.throttle=function(h,span,justPrepare){var task=new HitTask;return task.setOptions({span:span,maxCount:1}),task.pushHandler(h),justPrepare||task.process(),task},DataSense.debounce=function(h,delay,justPrepare){var task=new HitTask;return task.setOptions({delay:delay,mergeMode:"debounce"}),task.pushHandler(h),justPrepare||task.process(),task},DataSense.mono=function(h,delay,justPrepare){var task=new HitTask;return task.setOptions({delay:delay,mergeMode:"mono"}),task.pushHandler(h),justPrepare||task.process(),task},DataSense.multiHit=function(h,minCount,maxCount,span,justPrepare){var task=new HitTask;return task.setOptions({minCount:minCount,maxCount:maxCount,span:span}),task.pushHandler(h),justPrepare||task.process(),task},DataSense.schedule=function(h,span){var token,token2,processDate,stopDate,latest,clearToken=function(){token2&&token2.dispose(),token2=null,token&&(clearInterval(token),token=null)},process=function(source){processDate=new Date,h({startDate:undefined,latestStopDate:stopDate,processDate:processDate,latestProcessDate:latest,span:span,source:source}),latest=new Date},startProc=function(delay,source){clearToken(),token2=DataSense.delay(function(){token2=null,process(source),token=setInterval(function(){process("schedule")},span)},delay)},task={start:function(isPlan){var delay=!1,source=isPlan?"plan":"start";"number"==typeof isPlan?delay=isPlan:!0===isPlan&&(delay=span),startProc(delay,source)},process:function(){process("immediate")},resume:function(isPlan){token||token2||startProc(isPlan,"resume")},pause:function(){clearToken(),stopDate=new Date},stop:function(){clearToken(),stopDate=new Date},get alive(){return token||token2}};return task}}(DataSense||(DataSense={})),function(DataSense){var ValueObservable=function(){function ValueObservable(changer){var formatter,validator,disposable=new DataSense.DisposableArray;if(changer instanceof ValueObservable&&changer._instance)return this._instance=__assign(__assign({},changer._instance),{pushDisposable:function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return disposable.pushDisposable.apply(disposable,items)},removeDisposable:function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return disposable.removeDisposable.apply(disposable,items)},dispose:function(){disposable.dispose()}}),this.changing=changer.changing.createObservable(),this.changed=changer.changed.createObservable(),this.changeFailed=changer.changeFailed.createObservable(),this.broadcastReceived=changer.broadcastReceived.createObservable(),this.notifyReceived=changer.notifyReceived.createObservable(),this.pushDisposable(this.changing,this.changed,this.changeFailed,this.broadcastReceived,this.notifyReceived),void changer.pushDisposable(this);var obj=DataSense.Access.propsAccessor();obj.accessor.setFormatter(function(key,value){return"function"!=typeof formatter||"value"!==key?value:formatter(value)}),obj.accessor.setValidator(function(key,value){return"function"!=typeof validator||"value"!==key||validator(value)}),this.changing=obj.propChanging.createSingleObservable("value"),this.changed=obj.propChanged.createSingleObservable("value"),this.changeFailed=obj.propChangeFailed.createSingleObservable("value"),this.broadcastReceived=obj.propBroadcastReceived.createSingleObservable("value"),this.notifyReceived=obj.propNotifyReceived.createSingleObservable("value"),disposable.pushDisposable(this.changing,this.changed,this.changeFailed,this.broadcastReceived,this.notifyReceived);var simpleAccessor={get:function(options){return obj.accessor.getProp("value",options)},set:function(value,message){return obj.accessor.setProp("value",value,message)},forceUpdate:function(message){obj.accessor.forceUpdateProp("value",message)}},sendRequestH=function(type,value){obj.sendPropRequest("value",type,value,simpleAccessor)},sendBroadcastH=function(type,value){obj.sendPropBroadcast("value",type,value)};if(this._instance={get:function(options){return obj.accessor.getProp("value",options)},pushFlows:function(){for(var flows=[],_i=0;_i<arguments.length;_i++)flows[_i]=arguments[_i];return obj.pushFlows.apply(obj,__spreadArray(["value"],flows,!1))},clearFlows:function(){return obj.clearFlows("value")},sendRequest:function(type,value){sendRequestH(type,value)},sendBroadcast:function(data,message){sendBroadcastH(data,message)},pushDisposable:function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return disposable.pushDisposable.apply(disposable,items)},removeDisposable:function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return disposable.removeDisposable.apply(disposable,items)},dispose:function(){disposable.dispose()}},"function"==typeof changer){var eventsMore=changer.additionalEvents;eventsMore&&(eventsMore.broadcastReceived instanceof DataSense.SingleEventObservable&&(this.broadcastReceived=eventsMore.broadcastReceived,this.pushDisposable(this.broadcastReceived)),eventsMore.notifyReceived instanceof DataSense.SingleEventObservable&&(this.notifyReceived=eventsMore.notifyReceived,this.pushDisposable(this.notifyReceived)),"function"==typeof eventsMore.sendRequest&&(sendRequestH=eventsMore.sendRequest),"function"==typeof eventsMore.sendBroadcast&&(sendBroadcastH=eventsMore.sendBroadcast)),changer({get:function(options){return obj.accessor.getProp("value",options)},set:function(value,message){return obj.accessor.setProp("value",value,message)},customizedSet:function(valueRequested,message){return obj.accessor.customizedSetProp("value",valueRequested,message)},forceUpdate:function(message){obj.accessor.forceUpdateProp("value",message)},getFormatter:function(){return formatter},setFormatter:function(h){formatter=h},getValidator:function(){return validator},setValidator:function(h){validator=h},getStore:function(storePropKey){return obj.accessor.getPropStore("value",storePropKey)},setStore:function(storePropKey,value){obj.accessor.setPropStore("value",storePropKey,value)},removeStore:function(){for(var _a,storePropKey=[],_i=0;_i<arguments.length;_i++)storePropKey[_i]=arguments[_i];(_a=obj.accessor).removePropStore.apply(_a,__spreadArray(["value"],storePropKey,!1))},sendNotify:function(data,message){obj.accessor.sendPropNotify("value",data,message)},registerRequestHandler:function(type,h){return obj.accessor.registerPropRequestHandler("value",type,h)}})}}return ValueObservable.prototype.pushDisposable=function(){for(var _a,items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return(_a=this._instance).pushDisposable.apply(_a,items)},ValueObservable.prototype.removeDisposable=function(){for(var _a,items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];return(_a=this._instance).removeDisposable.apply(_a,items)},ValueObservable.prototype.get=function(options){return this._instance.get(options)},ValueObservable.prototype.getType=function(){return typeof this._instance.get()},ValueObservable.prototype.instanceOf=function(c){return this._instance.get()instanceof c},ValueObservable.prototype.registerChangeFlow=function(){for(var _a,value=[],_i=0;_i<arguments.length;_i++)value[_i]=arguments[_i];return(_a=this._instance).pushFlows.apply(_a,value)},ValueObservable.prototype.clearChangeFlow=function(){return this._instance.clearFlows()},ValueObservable.prototype.onChanging=function(h,thisArg,options,disposableArray){return this.changing.on(h,thisArg,options,disposableArray)},ValueObservable.prototype.onChanged=function(h,thisArg,options,disposableArray){return this.changed.on(h,thisArg,options,disposableArray)},ValueObservable.prototype.onChangeFailed=function(h,thisArg,options,disposableArray){return this.changeFailed.on(h,thisArg,options,disposableArray)},ValueObservable.prototype.onBroadcastReceived=function(h,thisArg,options,disposableArray){return this.broadcastReceived.on(h,thisArg,options,disposableArray)},ValueObservable.prototype.onNotifyReceived=function(h,thisArg,options,disposableArray){return this.notifyReceived.on(h,thisArg,options,disposableArray)},ValueObservable.prototype.subscribe=function(h,thisArg){return this.changed.subscribeWithConvertor(h,thisArg,function(newValue){return newValue.value})},ValueObservable.prototype.sendRequest=function(type,value){this._instance.sendRequest(type,value)},ValueObservable.prototype.sendBroadcast=function(data,message){this._instance.sendBroadcast(data,message)},ValueObservable.prototype.createObservable=function(){return new ValueObservable(this)},ValueObservable.prototype.dispose=function(){this._instance.dispose()},ValueObservable.prototype.toJSON=function(){var value=this._instance.get();try{if(null!=value)return JSON.stringify(value)}catch(ex){}return new String(value).toString()},ValueObservable}();DataSense.ValueObservable=ValueObservable;var ValueClient=function(_super){function ValueClient(defaultValue,modifier,setter,sendNotify,registerRequestHandler,additionalEvents,forceUpdate){var _this=this,h=function(acc){acc.set(defaultValue),modifier(acc.customizedSet)};return additionalEvents&&(h.additionalEvents=additionalEvents),_this=_super.call(this,h)||this,"function"==typeof setter&&(_this._setter=setter),"function"==typeof sendNotify&&(_this._sendNotify=sendNotify),"function"==typeof registerRequestHandler&&(_this._registerRequestHandler=registerRequestHandler),"function"==typeof forceUpdate&&(_this._forceUpdate=forceUpdate),_this}return __extends(ValueClient,_super),ValueClient.prototype.set=function(value,message){if("function"!=typeof this._setter)return!1;var info=this._setter(value,message);return!!info&&info.success},ValueClient.prototype.setForDetails=function(value,message){return"function"!=typeof this._setter?DataSense.ChangedInfo.fail(null,void 0,value,"not implemented"):this._setter(value,message)},ValueClient.prototype.setPromise=function(value,compatible,message){var _this=this;return DataSense.Access.setPromise(function(value,message){return _this.setForDetails(value,message)},value,compatible,message)},ValueClient.prototype.setSubscribe=function(value,message,callbackfn,thisArg){var _this=this;return DataSense.Access.setSubscribe(function(value,message){return _this.setForDetails(value,message)},value,message,callbackfn,thisArg)},ValueClient.prototype.forceUpdate=function(message){"function"==typeof this._forceUpdate&&this._forceUpdate(message)},ValueClient.prototype.sendNotify=function(data,message){this._sendNotify(data,message)},ValueClient.prototype.registerRequestHandler=function(type,h){return"function"==typeof this._registerRequestHandler&&this._registerRequestHandler(type,h)},ValueClient}(ValueObservable);DataSense.ValueClient=ValueClient;var ValueController=function(_super){function ValueController(){var a,_this=_super.call(this,function(acc){return a=acc})||this;return _this._accessor=a,_this}return __extends(ValueController,_super),Object.defineProperty(ValueController.prototype,"formatter",{get:function(){return this._accessor.getFormatter()},set:function(h){this._accessor.setFormatter(h)},enumerable:!1,configurable:!0}),Object.defineProperty(ValueController.prototype,"validator",{get:function(){return this._accessor.getValidator()},set:function(h){this._accessor.setValidator(h)},enumerable:!1,configurable:!0}),ValueController.prototype.set=function(value,message){var info=this._accessor.set(value,message);return!!info&&info.success},ValueController.prototype.setForDetails=function(value,message){return this._accessor.set(value,message)},ValueController.prototype.setPromise=function(value,compatible,message){var _this=this;return DataSense.Access.setPromise(function(value,message){return _this.setForDetails(value,message)},value,compatible,message)},ValueController.prototype.setSubscribe=function(value,message,callbackfn,thisArg){var _this=this;return DataSense.Access.setSubscribe(function(value,message){return _this.setForDetails(value,message)},value,message,callbackfn,thisArg)},ValueController.prototype.forceUpdate=function(message){this._accessor.forceUpdate(message)},ValueController.prototype.registerRequestHandler=function(type,h){return this._accessor.registerRequestHandler(type,h)},ValueController.prototype.observe=function(value,notSyncNow,message){return value instanceof ValueObservable?(this._observing=value.registerChangeFlow(this._accessor.customizedSet),notSyncNow||this._accessor.customizedSet(value.get(),message).resolve(),this._observing):{sync:function(){},dispose:function(){}}},ValueController.prototype.stopObserving=function(){var disposeObserving=this._observing;disposeObserving&&(delete this._observing,"function"==typeof disposeObserving.dispose&&disposeObserving.dispose())},ValueController.prototype.syncFromObserved=function(message){var disposeObserving=this._observing;return!(!disposeObserving||"function"!=typeof disposeObserving.sync)&&(disposeObserving.sync(message),!0)},ValueController.prototype.isObserving=function(){return!!this._observing},ValueController.prototype.createClient=function(){var token,_this=this,client=new ValueClient(this.get(),function(modifier){token=_this.onChanging(function(ev,evController){var updateToken=modifier(ev.valueRequest,evController.message);ev.observable&&(ev.observable.onResolved(function(newValue){updateToken.resolve(newValue)}),ev.observable.onRejected(function(err){updateToken.reject(err)}))})},function(value,message){return _this.setForDetails(value,message)},this._accessor.sendNotify,this._accessor.registerRequestHandler,{broadcastReceived:this.broadcastReceived.createObservable(),notifyReceived:this.notifyReceived.createObservable(),sendRequest:function(type,value){_this.sendRequest(type,value)},sendBroadcast:function(data,message){_this.sendBroadcast(data,message)}},function(message){_this.forceUpdate(message)});return client.pushDisposable(token),this.pushDisposable(client),client},ValueController.prototype.sendNotify=function(data,message){this._accessor.sendNotify(data,message)},ValueController}(ValueObservable);DataSense.ValueController=ValueController,DataSense.createValue=function(value){var p=new ValueController;return arguments.length>0&&p.set(value),p}}(DataSense||(DataSense={}));